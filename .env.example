# Celestia Alt-DA Server Configuration
# Copy this file to .env and configure for your environment

# =============================================================================
# IMPORTANT: CHOOSE YOUR DEPLOYMENT MODE
# =============================================================================
#
# You have TWO options for connecting to Celestia:
#
# OPTION B: Service Provider (e.g., Quicknode) - RECOMMENDED
#   - No local node required
#   - Uses RPC endpoint for reads (Get, GetAll, Subscribe)
#   - Uses gRPC endpoint for writes (Submit transactions via client-tx)
#   - Requires keyring for transaction signing
#   - Easiest setup for production
#
# OPTION A: Local Celestia Node (Light/Full Node)
#   - Run your own celestia-node locally
#   - Use RPC endpoint for both reads and writes
#   - Requires running local infrastructure
#
# Configure ONLY the section for your chosen mode below.
# =============================================================================

# =============================================================================
# REQUIRED: BASIC CONFIGURATION (Both Options)
# =============================================================================

# Celestia namespace (29 bytes hex, version 0 requires 18 leading zeros)
# Generate with: 00000000000000000000000000000000000000$(openssl rand -hex 10)
OP_ALTDA_CELESTIA_NAMESPACE=

# Server listening address (default: 127.0.0.1)
OP_ALTDA_ADDR=127.0.0.1

# Server listening port (default: 3100)
OP_ALTDA_PORT=3100

# SQLite database file path (default: ./blobs.db)
OP_ALTDA_DB_PATH=./data/blobs.db

# =============================================================================
# OPTION B: SERVICE PROVIDER (QUICKNODE) CONFIGURATION - RECOMMENDED
# =============================================================================
# Use this if you want to use a service provider without running local infrastructure
#
# Required for Option B:
# - OP_ALTDA_CELESTIA_SERVER (RPC endpoint for reads)
# - OP_ALTDA_CELESTIA_TX_CLIENT_CORE_GRPC_ADDR (gRPC endpoint for writes)
# - OP_ALTDA_CELESTIA_TX_CLIENT_KEYRING_PATH (keyring for signing)
# - OP_ALTDA_CELESTIA_TX_CLIENT_P2P_NETWORK (network: mocha-4, arabica-11, mainnet)
#
# According to celestia-node client-tx docs, you need BOTH:
# 1. RPC endpoint - for reads (blob.Get, blob.GetAll, blob.Subscribe)
# 2. gRPC endpoint - for writes (submitting transactions via client-tx)
# =============================================================================

# Celestia RPC endpoint (for reads: Get, GetAll, Subscribe)
# Example: https://your-endpoint.celestia-mocha.quiknode.pro/your-auth-token
OP_ALTDA_CELESTIA_SERVER=

# Celestia gRPC endpoint (for writes: Submit transactions)
# Example: your-endpoint.celestia-mocha.quiknode.pro:9090
OP_ALTDA_CELESTIA_TX_CLIENT_CORE_GRPC_ADDR=

# gRPC auth token (if required by provider)
OP_ALTDA_CELESTIA_TX_CLIENT_CORE_GRPC_AUTH_TOKEN=

# gRPC TLS enabled (default: true)
OP_ALTDA_CELESTIA_TX_CLIENT_CORE_GRPC_TLS_ENABLED=true

# Keyring key name (default: my_celes_key)
OP_ALTDA_CELESTIA_TX_CLIENT_KEY_NAME=my_celes_key

# Keyring path (where your keys are stored)
# Example: ~/.celestia-light-mocha-4/keys
# Initialize with: celestia light init --p2p.network mocha-4
# Create key with: celestia-appd keys add my_key --keyring-backend test --home ~/.celestia-light-mocha-4
OP_ALTDA_CELESTIA_TX_CLIENT_KEYRING_PATH=

# P2P network (mocha-4, arabica-11, mainnet)
OP_ALTDA_CELESTIA_TX_CLIENT_P2P_NETWORK=mocha-4

# Use compact blob IDs (default: true)
OP_ALTDA_CELESTIA_BLOBID_COMPACT=true

# =============================================================================
# OPTION A: LOCAL CELESTIA NODE CONFIGURATION
# =============================================================================
# Use this if you're running your own celestia-node (light or full node)
#
# Required for Option A:
# - OP_ALTDA_CELESTIA_SERVER (RPC endpoint)
# - OP_ALTDA_CELESTIA_AUTH_TOKEN (from ~/.celestia-*/keys/keyring-test/auth-token)
#
# Leave Option B settings empty/commented out
# =============================================================================

# Celestia RPC endpoint (for both reads and writes)
# OP_ALTDA_CELESTIA_SERVER=http://localhost:26658

# Celestia RPC auth token
# Light node: cat ~/.celestia-light/keys/keyring-test/auth-token
# Full node: cat ~/.celestia-full/keys/keyring-test/auth-token
# OP_ALTDA_CELESTIA_AUTH_TOKEN=

# Celestia RPC TLS (default: true)
# OP_ALTDA_CELESTIA_TLS_ENABLED=false

# Use compact blob IDs (default: true)
# OP_ALTDA_CELESTIA_BLOBID_COMPACT=true

# =============================================================================
# BATCH CONFIGURATION
# =============================================================================
# Control how blobs are batched before submission to Celestia
# Tune these as Celestia throughput grows

# Minimum number of blobs before creating a batch (default: 10)
OP_ALTDA_BATCH_MIN_BLOBS=10

# Maximum number of blobs per batch (default: 50)
OP_ALTDA_BATCH_MAX_BLOBS=50

# Target number of blobs to fetch for batching (default: 20)
OP_ALTDA_BATCH_TARGET_BLOBS=20

# Maximum batch size in MB (default: 1)
OP_ALTDA_BATCH_MAX_SIZE_MB=1

# Minimum batch size in KB before forcing submission (default: 500)
OP_ALTDA_BATCH_MIN_SIZE_KB=500

# =============================================================================
# WORKER CONFIGURATION
# =============================================================================
# Control worker timeouts and retry behavior

# How often submission worker checks for pending blobs (default: 2s)
OP_ALTDA_WORKER_SUBMIT_PERIOD=2s

# Timeout for submitting batch to Celestia (default: 60s)
OP_ALTDA_WORKER_SUBMIT_TIMEOUT=60s

# Maximum retries for failed submissions (default: 10)
OP_ALTDA_WORKER_MAX_RETRIES=10

# How often event listener reconciles unconfirmed batches (default: 30s)
OP_ALTDA_WORKER_RECONCILE_PERIOD=30s

# Age threshold for reconciling unconfirmed batches (default: 2m)
OP_ALTDA_WORKER_RECONCILE_AGE=2m

# Timeout for Celestia Get operations during reconciliation (default: 30s)
OP_ALTDA_WORKER_GET_TIMEOUT=30s

# =============================================================================
# S3 BACKUP CONFIGURATION (Optional)
# =============================================================================
# Enable periodic database backups to S3 for disaster recovery

# Enable periodic S3 database backups (default: false)
OP_ALTDA_BACKUP_ENABLED=false

# Backup interval (default: 1h)
# Format: 1h, 30m, 6h, etc.
OP_ALTDA_BACKUP_INTERVAL=1h

# S3 authentication type: iam or static
OP_ALTDA_S3_CREDENTIAL_TYPE=iam

# S3 bucket name for database backups
OP_ALTDA_S3_BUCKET=

# S3 path prefix
OP_ALTDA_S3_PATH=celestia-da/backups

# S3 endpoint URL (leave empty for AWS S3)
OP_ALTDA_S3_ENDPOINT=

# S3 access key ID (if credential-type=static)
OP_ALTDA_S3_ACCESS_KEY_ID=

# S3 access key secret (if credential-type=static)
OP_ALTDA_S3_ACCESS_KEY_SECRET=

# S3 timeout (default: 5s)
OP_ALTDA_S3_TIMEOUT=5s

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level: DEBUG, INFO, WARN, ERROR (default: INFO)
OP_ALTDA_LOG_LEVEL=INFO

# Log format: text, terminal, logfmt, json, json-pretty (default: text)
OP_ALTDA_LOG_FORMAT=text

# Enable colored log output (default: false)
OP_ALTDA_LOG_COLOR=false

# Show process ID in logs (default: false)
OP_ALTDA_LOG_PID=false

# =============================================================================
# METRICS CONFIGURATION
# =============================================================================
#
# Exposes Prometheus metrics for monitoring Celestia DA operations:
# - celestia_submission_duration_seconds: Time to submit batches to Celestia
# - celestia_submission_size_bytes: Size of data submitted (in bytes)
# - celestia_submissions_total: Total number of submissions
# - celestia_submission_errors_total: Total number of failed submissions
# - celestia_retrieval_duration_seconds: Time to retrieve blobs from Celestia
# - celestia_retrieval_size_bytes: Size of data retrieved (in bytes)
# - celestia_retrievals_total: Total number of retrievals
# - celestia_retrieval_errors_total: Total number of failed retrievals

# Enable Prometheus metrics (default: false)
OP_ALTDA_METRICS_ENABLED=false

# Prometheus metrics server port (default: 6060)
OP_ALTDA_METRICS_PORT=6060

# =============================================================================
# DEPRECATED OPTIONS (Do not use)
# =============================================================================

# These options are deprecated and will be removed in future versions
# OP_ALTDA_FALLBACK=false
# OP_ALTDA_CACHE=false
