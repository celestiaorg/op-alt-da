# Celestia Alt-DA Server Configuration - READER
# ==============================================================================
# READ-ONLY SERVER: Serves GET requests via backfill from Celestia
# ==============================================================================

# ==============================================================================
# BASIC OP-ALT-DA SERVER CONFIGURATION
# ==============================================================================

# Server listening address
addr = "0.0.0.0"

# Server listening port (different from writer)
port = 3101

# SQLite database file path (separate from writer)
db_path = "./tests/manual/reader-blobs.db"

# Log level: DEBUG, INFO, WARN, ERROR
log_level = "INFO"

# Log format: text, terminal, logfmt, json, json-pretty
log_format = "text"

# Enable colored log output
log_color = false

# Show process ID in logs
log_pid = false

# ==============================================================================
# READ-ONLY MODE CONFIGURATION
# ==============================================================================

# READER: read_only = true (rejects PUT requests)
read_only = true

# ==============================================================================
# CELESTIA CONFIGURATION
# ==============================================================================

[celestia]
# Celestia namespace (29 bytes hex, version 0 requires 18 leading zeros)
# SAME namespace as writer (changed last 5 chars: ...c3 -> ...ab)
namespace = "00000000000000000000000000000000000000655bc8d4c270c556acfe"

# DA Node RPC server URL (for reads: Get, GetAll, Subscribe)
da_rpc_server = "http://151.115.62.190:26658"

# RPC auth token (from ~/.celestia-*/keys/keyring-test/auth-token)
auth_token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJwdWJsaWMiLCJyZWFkIiwid3JpdGUiLCJhZG1pbiJdLCJOb25jZSI6IlhJakVKNXV4UjJXOG1ERnErbzh5NkdtRHFhTUV3ZDRmejM3RC92MzdMWTg9IiwiRXhwaXJlc0F0IjoiMDAwMS0wMS0wMVQwMDowMDowMFoifQ.Bokj6b5p2AXz-QjcSSG2qAyA3Lrnc5uleczXd106jN8"

# RPC TLS enabled
tls_enabled = false

# Use compact blob IDs (recommended: true for smaller commitments)
blobid_compact = true

# ==============================================================================
# CELESTIA TX CLIENT CONFIGURATION (Option B only - Service Provider)
# ==============================================================================

[celestia.tx_client]
# Not using service provider - using local node auth_token instead
core_grpc_addr = ""
core_grpc_auth_token = ""
core_grpc_tls_enabled = true
default_key_name = "my_celes_key"
keyring_path = ""
p2p_network = "mocha-4"

# ==============================================================================
# BATCH CONFIGURATION
# ==============================================================================

[batch]
# Minimum number of blobs before creating a batch
# With 1MB blobs every 2.5s, we get ~2.4 blobs per 6s Celestia block
# Setting to 2 allows efficient batching without unnecessary delay
min_blobs = 2

# Maximum number of blobs per batch
# Celestia max blob size ~2MB, so max 2 x 1MB blobs per batch
max_blobs = 3

# Target number of blobs to fetch for batching
# Aim for 2 blobs (2MB total) to fill Celestia efficiently
target_blobs = 2

# Maximum batch size in KB
# Celestia supports ~2MB blobs, set to 1.8MB (1843KB) for safety margin
max_size_kb = 1843

# Minimum batch size in KB before forcing submission
# With 1MB execution blocks, wait for at least 1.5MB before submitting
# This ensures 1-2 execution blocks per batch
min_size_kb = 500

# ==============================================================================
# WORKER CONFIGURATION
# ==============================================================================

[worker]
# How often submission worker checks for pending blobs
submit_period = "6s"

# Timeout for submitting batch to Celestia
submit_timeout = "60s"

# Maximum retries for failed submissions
max_retries = 10

# Max time a blob waits before forced submission
max_blob_wait_time = "12s"

# How often event listener reconciles unconfirmed batches
# For readers, this also determines backfill scan frequency
# PRODUCTION: 1s for high-throughput (400KB/s) to minimize read latency
reconcile_period = "1s"

# Age threshold for reconciling unconfirmed batches
reconcile_age = "12s"

# Timeout for Celestia Get operations during reconciliation
get_timeout = "30s"

# READER: MUST configure trusted_signers for security!
# This is the Bech32 address from the writer's logs
# After starting writer, check logs: grep "signer_bech32" writer.log
# For now using the example address - UPDATE THIS with real writer address!
trusted_signers = ["celestia15m7s9d0ldd9ur9mgh9m6r4kc396dp68szwqmyc"]

# ==============================================================================
# BACKFILL CONFIGURATION
# ==============================================================================

[backfill]
# READER: Backfill enabled to index from Celestia
enabled = true

# Starting Celestia block height for backfill
# Set to 0 to start from latest (recommended for new deployments)
# Set to specific height only if you need historical data
start_height = 8967969

# Ending Celestia block height for backfill (0 = current chain tip)
end_height = 0

# How many blocks to scan per iteration
# PRODUCTION SETTINGS for 400KB/s throughput:
# Celestia Mocha-4: ~10 blocks/minute (1 block every ~6s)
# With reconcile_period = 1s, scan capacity = 5 blocks × 60 = 300 blocks/min
# This provides 30x safety margin over Celestia's 10 blocks/min production rate
#
# For high-throughput production, use lower values for efficiency:
# - 5 blocks per scan: Optimal for real-time indexing
# - Scan capacity: 5 × 60 = 300 blocks/min (30x safety margin)
blocks_per_scan = 5

# ==============================================================================
# S3 BACKUP CONFIGURATION (Optional)
# ==============================================================================

[backup]
enabled = false
interval = "1h"

[s3]
credential_type = "iam"
bucket = ""
path = "celestia-da/backups"
endpoint = ""
access_key_id = ""
access_key_secret = ""
timeout = "5s"

# ==============================================================================
# METRICS CONFIGURATION
# ==============================================================================

[metrics]
enabled = false
port = 6061  # Different port from writer if running on same machine
