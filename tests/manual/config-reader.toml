# Celestia Alt-DA Server Configuration - READER
# ==============================================================================
# READ-ONLY SERVER: Serves GET requests via backfill from Celestia
# ==============================================================================

# ==============================================================================
# BASIC OP-ALT-DA SERVER CONFIGURATION
# ==============================================================================

# Server listening address
addr = "0.0.0.0"

# Server listening port (different from writer)
port = 3101

# SQLite database file path (separate from writer)
db_path = "./tests/manual/reader-blobs.db"

# Log level: DEBUG, INFO, WARN, ERROR
log_level = "INFO"

# Log format: text, terminal, logfmt, json, json-pretty
log_format = "text"

# Enable colored log output
log_color = false

# Show process ID in logs
log_pid = false

# ==============================================================================
# READ-ONLY MODE (enabled for this reader server)
# ==============================================================================
# When enabled:
#   - PUT requests are rejected (server only serves GET requests)
#   - Submission worker is disabled
#   - Backfill worker syncs data from Celestia
#
# Requirements for read-only mode:
#   - [backfill] enabled = true (to sync from Celestia)
#   - [worker] trusted_signers must list writer's Celestia addresses
#
# CLI equivalent: --read-only
# Env var: OP_ALTDA_READ_ONLY=true
read_only = true

# ==============================================================================
# CELESTIA CONFIGURATION
# ==============================================================================

[celestia]
# Celestia namespace (29 bytes hex, version 0 requires 18 leading zeros)
# SAME namespace as writer
namespace = "0000000000000000000000000000000000000041ca0e22713b4d1c5912"
# Use compact blob IDs
blobid_compact = true

bridge_addr = "https://young-weathered-scion.celestia-mocha.quiknode.pro/2ae91d0d78ef0a253990449d0bb7e9f054f024c0/"
# bridge_auth_token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJwdWJsaWMiLCJyZWFkIiwid3JpdGUiLCJhZG1pbiJdLCJOb25jZSI6IlhJakVKNXV4UjJXOG1ERnErbzh5NkdtRHFhTUV3ZDRmejM3RC92MzdMWTg9IiwiRXhwaXJlc0F0IjoiMDAwMS0wMS0wMVQwMDowMDowMFoifQ.Bokj6b5p2AXz-QjcSSG2qAyA3Lrnc5uleczXd106jN8"
bridge_addr_wss = "wss://young-weathered-scion.celestia-mocha.quiknode.pro/2ae91d0d78ef0a253990449d0bb7e9f054f024c0/"
bridge_auth_token = ""
bridge_tls_enabled = true

# CoreGRPC settings (for submitting blobs)
core_grpc_addr = "consensus-full-mocha-4.celestia-mocha.com:9090"
core_grpc_auth_token = ""
core_grpc_tls_enabled = true

# Keyring settings (for signing)
keyring_path = "~/.celestia-light-mocha-4/keys"
default_key_name = "my_celes_key"
p2p_network = "mocha-4"

# 5b9b bc07 3f02 b4bd

# ==============================================================================
# BATCH CONFIGURATION
# ==============================================================================

[batch]
# Minimum number of blobs before creating a batch
# With 1MB blobs every 2.5s, we get ~2.4 blobs per 6s Celestia block
# Setting to 2 allows efficient batching without unnecessary delay
min_blobs = 3

# Maximum number of blobs per batch
# Celestia max blob size ~2MB, so max 2 x 1MB blobs per batch
max_blobs = 8

# Target number of blobs to fetch for batching
# Aim for 2 blobs (2MB total) to fill Celestia efficiently
target_blobs = 5

# Maximum batch size in KB
# Celestia supports ~2MB blobs, set to 1.8MB (1843KB) for safety margin
max_size_kb = 8343

# Minimum batch size in KB before forcing submission
# With 1MB execution blocks, wait for at least 1.5MB before submitting
# This ensures 1-2 execution blocks per batch
min_size_kb = 500

# ==============================================================================
# WORKER CONFIGURATION
# ==============================================================================
# Reader doesn't submit blobs, but needs worker config for reconciliation

[worker]
# Timeout for submitting batch to Celestia (not used in read-only mode)
submit_timeout = "60s"

# Maximum retries for failed submissions (not used in read-only mode)
max_retries = 3

# Wait time between retries (not used in read-only mode)
retry_backoff = "1s"

# How often event listener reconciles unconfirmed batches
# For readers, this also determines backfill scan frequency
# PRODUCTION: 1s for high-throughput (400KB/s) to minimize read latency
reconcile_period = "1s"

# Age threshold for reconciling unconfirmed batches
reconcile_age = "12s"

# Timeout for Celestia Get operations during reconciliation
get_timeout = "30s"

# READER: MUST configure trusted_signers for security!
# This is the Bech32 address from the writer's logs
# After starting writer, check logs: grep "signer_bech32" writer.log
# For now using the example address - UPDATE THIS with real writer address!
trusted_signers = [
    "celestia1gazv7rsqd5tdmr67tg8p0s5ardxv60k4wnyqfw",
    "celestia1qxdkn22x62d5h8pxaceghylwal7q0r352hndmr",
    "celestia1yq37dq6sz0yvgxk8gpkfppypyqxptze9thyp48",
    "celestia1rw6x3v8le8lmxf7ena8gexhm4lyfgj9hy23fuw",
    "celestia1qhfvv7a6tpdv3pphrmenv3r20acrgvqrptx5pw",
    "celestia19z2k2yxa06a8hf4l9wqt0s4kkyy4fyph84sefs",
    "celestia1rwjv6gawl7adj6tu8v3hyj2q8zme23y7w6zupk",
    "celestia1fmmjrkxt6mvl0zkeretz60rhucyffqd7vxqd0n",
]

# ==============================================================================
# BACKFILL CONFIGURATION
# ==============================================================================

[backfill]
# READER: Backfill enabled to index from Celestia
enabled = true

# Starting Celestia block height for backfill
# Set to 0 to start from latest (recommended for new deployments)
# Set to specific height only if you need historical data
start_height = 9088102

# Ending Celestia block height for backfill (0 = current chain tip)
end_height = 0

# How often to scan for new Celestia blocks
# Lower = faster catch-up but more CPU
period = "500ms"

# How many blocks to scan per iteration (also = parallel GetAll concurrency)
# Higher = faster scanning but more load on Celestia node
# For aggressive catch-up: 50-100
blocks_per_scan = 50

# Re-scan last N heights to catch late-propagating blobs
confirmation_depth = 15

# ==============================================================================
# S3 BACKUP CONFIGURATION (Optional)
# ==============================================================================

[backup]
enabled = false
interval = "1h"

[s3]
credential_type = "iam"
bucket = ""
path = "celestia-da/backups"
endpoint = ""
access_key_id = ""
access_key_secret = ""
timeout = "5s"

# ==============================================================================
# METRICS CONFIGURATION
# ==============================================================================

[metrics]
enabled = true
port = 6061    # Different port from writer if running on same machine
