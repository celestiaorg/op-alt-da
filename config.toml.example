# Celestia Alt-DA Server Configuration
# ==============================================================================
# ARCHITECTURE
# ==============================================================================
#
# This server uses a dual-endpoint architecture for Celestia:
#
# 1. BRIDGE NODE (JSON-RPC) - for reading blobs
#    - da_rpc_server: Your bridge/light node endpoint
#    - auth_token: Authentication for the bridge node
#
# 2. CORE GRPC - for submitting blobs
#    - core_grpc_addr: Celestia consensus node gRPC endpoint
#    - keyring_path: Local keyring for transaction signing
#
# This architecture is required because submitting blobs through
# bridge node RPC is deprecated.
#
# ==============================================================================

# ==============================================================================
# BASIC OP-ALT-DA SERVER CONFIGURATION
# ==============================================================================

# Server listening address
addr = "127.0.0.1"

# Server listening port
port = 3100

# SQLite database file path
db_path = "./data/blobs.db"

# Log level: DEBUG, INFO, WARN, ERROR
log_level = "INFO"

# Log format: text, terminal, logfmt, json, json-pretty
log_format = "terminal"

# Enable colored log output
log_color = true

# Show process ID in logs
log_pid = false

# ==============================================================================
# CELESTIA CONFIGURATION
# ==============================================================================

[celestia]
# Celestia namespace (29 bytes hex, version 0 requires 18 leading zeros)
# Generate with: 00000000000000000000000000000000000000$(openssl rand -hex 10)
namespace = ""

# Use compact blob IDs (recommended: true for smaller commitments)
blobid_compact = true

# -----------------------------------------------------------------------------
# Bridge Node Settings (for reading blobs via JSON-RPC)
# -----------------------------------------------------------------------------

# Bridge node JSON-RPC endpoint
# Example: http://localhost:26658 or https://your-endpoint.celestia-mocha.quiknode.pro/token
bridge_addr = ""

# Auth token for bridge node (optional, some providers require it)
# Get from: ~/.celestia-*/keys/keyring-test/auth-token
bridge_auth_token = ""

# Enable TLS for bridge node connection
bridge_tls_enabled = false

# -----------------------------------------------------------------------------
# CoreGRPC Settings (for submitting blobs)
# -----------------------------------------------------------------------------

# Consensus node gRPC endpoint (required)
# Example: consensus-full-mocha-4.celestia-mocha.com:9090 or your-provider:9090
core_grpc_addr = ""

# Auth token for gRPC (optional, some providers like QuickNode require it)
core_grpc_auth_token = ""

# Enable TLS for gRPC connection
core_grpc_tls_enabled = true

# -----------------------------------------------------------------------------
# Keyring Settings (for signing transactions)
# -----------------------------------------------------------------------------

# Keyring path (required - where your keys are stored)
# Example: ~/.celestia-light-mocha-4/keys
# Initialize with: celestia light init --p2p.network mocha-4
# Create key with: celestia-appd keys add my_key --keyring-backend test --home ~/.celestia-light-mocha-4
keyring_path = ""

# Key name to use for signing (required)
default_key_name = "my_celes_key"

# P2P network (required): mocha-4, arabica-11, mainnet
p2p_network = "mocha-4"

# -----------------------------------------------------------------------------
# Parallel Submission Settings (Optional)
# -----------------------------------------------------------------------------
# Parallel submission is configured on your Celestia node, not here.
# To enable parallel blob submission:
#
# 1. Configure your Celestia node's config.toml:
#    [State]
#    TxWorkerAccounts = 8  # Creates 8 parallel submission lanes
#
# 2. Initialize your Celestia node: celestia light init
#
# 3. Run: da-server init --config config.toml
#    This lists all signer addresses (primary + workers)
#
# 4. Add ALL addresses to your reader's trusted_signers
#
# This field documents expected worker accounts (for init command)
tx_worker_accounts = 0

# ==============================================================================
# BATCH CONFIGURATION
# ==============================================================================
# Control how blobs are batched before submission to Celestia
# Tune these as Celestia throughput grows

[batch]
# Minimum number of blobs before creating a batch
min_blobs = 10

# Maximum number of blobs per batch
max_blobs = 50

# Target number of blobs to fetch for batching
target_blobs = 20

# Maximum batch size in MB
max_size_mb = 1

# Minimum batch size in KB before forcing submission
min_size_kb = 500

# ==============================================================================
# WORKER CONFIGURATION
# ==============================================================================
# Control worker timeouts and retry behavior
# Optimized for Celestia block time (~6 seconds)

[worker]
# How often submission worker checks for pending blobs
# Recommended: 6s (aligned with Celestia block time)
submit_period = "6s"

# Timeout for submitting batch to Celestia
submit_timeout = "60s"

# Maximum retries for failed submissions
max_retries = 10

# Max time a blob waits before forced submission
# Recommended: 12s (2 blocks - allows batching but prevents long waits)
max_blob_wait_time = "12s"

# How often event listener reconciles unconfirmed batches
# Recommended: 6s (check every Celestia block for confirmations)
reconcile_period = "6s"

# Age threshold for reconciling unconfirmed batches
# Recommended: 12s (2 blocks - enough time for Celestia confirmation)
reconcile_age = "12s"

# Timeout for Celestia Get operations during reconciliation
get_timeout = "30s"

# Trusted write server signers (REQUIRED for read-only mode to prevent Woods attack)
# Must be Celestia Bech32 addresses (format defined by celestia-app)
# Get your writer's signer address from logs: "Celestia signer address configured"
# Example: trusted_signers = ["celestia15m7s9d0ldd9ur9mgh9m6r4kc396dp68szwqmyc"]
trusted_signers = []

# ==============================================================================
# READ-ONLY MODE CONFIGURATION
# ==============================================================================
# Run server in read-only mode (no writes to Celestia)
# Requires trusted_signers to be configured for security

read_only = false

# ==============================================================================
# BACKFILL CONFIGURATION
# ==============================================================================
# Backfill historical blobs from Celestia into local database

[backfill]
# Enable backfill on startup
enabled = false

# Starting Celestia block height for backfill
start_height = 1

# Ending Celestia block height for backfill (0 = current chain tip)
end_height = 0

# ==============================================================================
# S3 BACKUP CONFIGURATION (Optional)
# ==============================================================================
# Enable periodic database backups to S3 for disaster recovery

[backup]
# Enable periodic S3 database backups
enabled = false

# Backup interval (examples: 1h, 30m, 6h)
interval = "1h"

[s3]
# S3 authentication type: iam or static
credential_type = "iam"

# S3 bucket name for database backups
bucket = ""

# S3 path prefix
path = "celestia-da/backups"

# S3 endpoint URL (leave empty for AWS S3)
endpoint = ""

# S3 access key ID (if credential_type = "static")
access_key_id = ""

# S3 access key secret (if credential_type = "static")
access_key_secret = ""

# S3 timeout
timeout = "5s"

# ==============================================================================
# METRICS CONFIGURATION
# ==============================================================================
# Exposes Prometheus metrics for monitoring Celestia DA operations

[metrics]
# Enable Prometheus metrics server
enabled = false

# Prometheus metrics server port
port = 6060

# Available metrics:
# - celestia_submission_duration_seconds: Time to submit batches to Celestia
# - celestia_submission_size_bytes: Size of data submitted (in bytes)
# - celestia_submissions_total: Total number of submissions
# - celestia_submission_errors_total: Total number of failed submissions
# - celestia_retrieval_duration_seconds: Time to retrieve blobs from Celestia
# - celestia_retrieval_size_bytes: Size of data retrieved (in bytes)
# - celestia_retrievals_total: Total number of retrievals
# - celestia_retrieval_errors_total: Total number of failed retrievals
